import{_ as w,r as h,p as S,d as D,f as O,m as y,u as A,c as m,a,e as J,t as l,q as n,w as P,h as L,j as C,s as V,x as z,y as B,F as j,i as W,o as d,z as q}from"./index-BBkAQfZn.js";import{u as H}from"./caregiverStore-BzssTZa9.js";import{u as U}from"./AppointmentStore-B5xb3BvQ.js";import"@/assets/main.css";const F={class:"wrapper"},G={class:"search-conditions card-section mb-6"},K={class:"flex justify-between items-center"},Q={class:"conditions-container"},X={class:"condition-tags"},Y={class:"condition-tag"},Z={class:"value"},ee={class:"condition-tag"},te={class:"value"},oe={class:"condition-tag"},ae={class:"value"},se={key:0},re={key:1},le={class:"header flex justify-between items-center mb-6"},ie={class:"text-xl font-semibold text-gray-800"},ne={key:0,class:"text-center py-10 bg-white rounded-lg shadow-sm"},ce={class:"text-sm text-gray-500"},ue={class:"caregiver-grid"},me=["onClick"],de=["src","alt"],ge={class:"flex justify-between items-center mb-2"},pe={class:"text-lg font-semibold text-teal-600"},ye=["onClick"],fe={key:0},ve={key:1},he={class:"caregiver-info"},Se={class:"info-row text-sm text-gray-600"},_e={class:"text-sm text-gray-600"},xe={class:"text-sm text-gray-600"},Ie={class:"text-sm text-gray-600"},Te={class:"text-sm text-gray-600"},De={class:"text-sm text-gray-600 mt-2 line-clamp-2"},Ce={class:"text-sm text-teal-700 font-semibold mt-2"},$e={__name:"CaregiverList",setup(be){const f=A(),c=H(),r=U(),g=h([]),p=h(localStorage.getItem("sortOption")||"price"),i=h({}),_=e=>g.value.includes(e);S(p,e=>{localStorage.setItem("sortOption",e)}),S(()=>c.filters,e=>{localStorage.setItem("serviceCity",e.serviceCity||""),localStorage.setItem("serviceDistrict",e.serviceDistrict||""),localStorage.setItem("desiredStartTime",e.desiredStartTime||""),localStorage.setItem("desiredEndTime",e.desiredEndTime||""),localStorage.setItem("gender",e.gender||"null"),localStorage.setItem("nationality",e.nationality||"null"),localStorage.setItem("languages",e.languages||"null"),localStorage.setItem("hourlyRateMin",e.hourlyRateMin||"null"),localStorage.setItem("hourlyRateMax",e.hourlyRateMax||"null")},{deep:!0}),S(()=>c.caregivers,e=>{localStorage.setItem("caregivers",JSON.stringify(e)),i.value={},e.forEach(t=>{$(t.caregiverId)})},{deep:!0}),D(()=>{r.appointment.timeType=localStorage.getItem("timeType")||"continuous",r.continuous.startTime=localStorage.getItem("continuousStartTime")||"",r.continuous.endTime=localStorage.getItem("continuousEndTime")||"",r.continuous.startDate=localStorage.getItem("continuousStartDate")||"",r.continuous.endDate=localStorage.getItem("continuousEndDate")||"",r.multi.startDate=localStorage.getItem("multiStartDate")||"",r.multi.endDate=localStorage.getItem("multiEndDate")||"",r.multi.dailyStartTime=JSON.parse(localStorage.getItem("multiDailyStartTime")||"{}"),r.multi.dailyEndTime=JSON.parse(localStorage.getItem("multiDailyEndTime")||"{}"),r.multi.repeatDays=JSON.parse(localStorage.getItem("multiRepeatDays")||"{}"),r.multi.timeSlots=JSON.parse(localStorage.getItem("multiTimeSlots")||"[]"),c.setFilters({serviceCity:localStorage.getItem("serviceCity")||"",serviceDistrict:localStorage.getItem("serviceDistrict")||"",desiredStartTime:localStorage.getItem("desiredStartTime")||"",desiredEndTime:localStorage.getItem("desiredEndTime")||"",gender:localStorage.getItem("gender")==="null"?null:localStorage.getItem("gender"),nationality:localStorage.getItem("nationality")==="null"?null:localStorage.getItem("nationality"),languages:localStorage.getItem("languages")==="null"?null:localStorage.getItem("languages"),hourlyRateMin:localStorage.getItem("hourlyRateMin")==="null"?null:Number(localStorage.getItem("hourlyRateMin")),hourlyRateMax:localStorage.getItem("hourlyRateMax")==="null"?null:Number(localStorage.getItem("hourlyRateMax"))});const e=localStorage.getItem("caregivers");if(e)try{const t=JSON.parse(e);Array.isArray(t)?c.setCaregivers(t):(console.warn("Stored caregivers is not an array, clearing localStorage."),localStorage.removeItem("caregivers"))}catch(t){console.error("Error parsing stored caregivers:",t),localStorage.removeItem("caregivers")}});const $=async e=>{try{console.log(`Fetching price for caregiver ID: ${e}`),console.log("Appointment Time Type:",r.appointment.timeType);let t=null;if(r.appointment.timeType==="continuous"){console.log("Calculating for continuous time...");const s=r.continuous;console.log("Continuous data:",s);const o=s.startTime?`${s.startTime}:00`:null,u=s.endTime?`${s.endTime}:00`:null,M=s.startDate&&o?`${s.startDate}T${o}`:null,N=s.endDate&&u?`${s.endDate}T${u}`:null;t=(await y.get("/api/appointment/estimate/continuous",{params:{caregiverId:e,startTime:M,endTime:N}})).data}else r.appointment.timeType;t!==null?(i.value[e]=t,console.log(`Estimated price stored for caregiver ${e}:`,i.value[e])):console.log(`Amount is null for caregiver ${e}.`)}catch(t){console.error(`Failed to fetch estimate price for caregiver ${e}:`,t),i.value[e]="無法估價"}},v=O(()=>{const e=[...c.caregivers];return p.value==="price"?e.sort((t,s)=>(i.value[t.caregiverId]==="無法估價"?1/0:i.value[t.caregiverId])-(i.value[s.caregiverId]==="無法估價"?1/0:i.value[s.caregiverId])):p.value==="experience"&&e.sort((t,s)=>s.yearOfExperience-t.yearOfExperience),e}),x=e=>e?new Date(e).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}):"未指定",I=e=>e?new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}):"未指定",T=e=>{if(!e||typeof e.hour>"u"||typeof e.minute>"u")return"未指定";const t=parseInt(e.hour,10),s=e.minute.padStart(2,"0");let o="AM",u=t;return t===0?u=12:t===12?o="PM":t>12&&(u=t-12,o="PM"),`${u}:${s} ${o}`},b=(e,t)=>{const s=T(e),o=T(t);return`${s} - ${o}`},E=e=>{console.log("Selected caregiver:",e),console.log("Selected caregiver ID:",e.caregiverId),c.selectCaregiver(e),localStorage.setItem("selectedCaregiver",JSON.stringify(e)),f.push(`/caregivers/${e.caregiverId}`)},R=()=>{f.push("/caregivers/search")},k=async e=>{var s;const t=_(e);try{t?(await y.delete("/favorites/deleteEmployee",{params:{caregiverId:e}}),g.value=g.value.filter(o=>o!==e)):(await y.post("/favorites/addEmployee",null,{params:{caregiverId:e}}),g.value.push(e))}catch(o){console.error("收藏操作失敗",o),((s=o.response)==null?void 0:s.status)===401&&(alert("請先登入才能操作收藏"),f.push("/userlogin"))}};return D(async()=>{var e;try{const t=await y.get("/favorites/employees");g.value=t.data.map(s=>s.caregiverId)}catch(t){console.error("取得收藏照護者失敗",t),((e=t.response)==null?void 0:e.status)===401&&(alert("請先登入才能查看收藏的照護者"),f.push("/user/login"));try{const s=await y.get("/favorites/employees");g.value=s.data.map(o=>o.caregiverId)}catch(s){console.error("取得收藏照護者失敗",s)}}}),(e,t)=>{const s=B("router-link");return d(),m("div",F,[a("div",G,[a("div",K,[a("div",Q,[t[4]||(t[4]=a("h3",{class:"text-xl font-semibold text-gray-800 mb-3"},"您的搜尋條件",-1)),a("div",X,[a("span",Y,[t[1]||(t[1]=a("span",{class:"label"},"服務縣市：",-1)),a("span",Z,l(n(c).filters.serviceCity||"未指定"),1)]),a("span",ee,[t[2]||(t[2]=a("span",{class:"label"},"服務地區：",-1)),a("span",te,l(n(c).filters.serviceDistrict||"未指定"),1)]),a("span",oe,[t[3]||(t[3]=a("span",{class:"label"},"時間選擇：",-1)),a("span",ae,[n(r).appointment.timeType==="continuous"?(d(),m("span",se,l(x(n(r).continuous.startTime))+" - "+l(x(n(r).continuous.endTime))+"（連續時間） ",1)):(d(),m("span",re,l(I(n(r).multi.startDate))+" - "+l(I(n(r).multi.endDate))+" （每日 "+l(b(n(r).multi.dailyStartTime,n(r).multi.dailyEndTime))+"，多時段預訂） ",1))])])])]),a("button",{onClick:R,class:"px-4 py-2 bg-teal-600 text-white rounded-md text-sm font-medium hover:bg-teal-700 transition-colors"}," 返回搜尋 ")])]),a("div",le,[a("h3",ie," 搜尋結果，共 "+l(v.value.length)+" 位看護 ",1),P(a("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>p.value=o),class:"border p-2 rounded-md text-gray-600 focus:border-teal-600 focus:ring focus:ring-teal-200 focus:ring-opacity-50"},t[5]||(t[5]=[a("option",{value:"price"},"按預估總價排序",-1),a("option",{value:"experience"},"按經驗年數排序",-1)]),512),[[L,p.value]])]),v.value.length===0?(d(),m("div",ne,[t[8]||(t[8]=a("p",{class:"text-lg text-gray-600 mb-2"},"很抱歉，沒有符合條件的看護！",-1)),a("p",ce,[t[7]||(t[7]=C(" 請調整搜尋條件，或 ")),V(s,{to:"/user-center/favorites",class:"text-teal-600 underline ml-1"},{default:z(()=>t[6]||(t[6]=[C(" 查看收藏庫 ")])),_:1})])])):J("",!0),a("div",ue,[(d(!0),m(j,null,W(v.value,o=>(d(),m("div",{class:"caregiver-card",key:o.caregiverId,onClick:u=>E(o)},[a("img",{class:"caregiver-image",src:o.photoPath||"https://finalimagesbucket.s3.amazonaws.com/default-placeholder.jpg",alt:`看護 ${o.caregiverName}`},null,8,de),a("div",ge,[a("h3",pe,l(o.caregiverName),1),a("button",{onClick:q(u=>k(o.caregiverId),["stop"]),class:"text-red-500 hover:text-red-600 text-xl"},[_(o.caregiverId)?(d(),m("span",fe,"♥")):(d(),m("span",ve,"♡"))],8,ye)]),a("div",he,[a("div",Se,[a("span",null,"性別："+l(o.gender),1),a("span",null,"國籍："+l(o.nationality||"未知"),1),a("span",null,"語言："+l(o.languages||"未知"),1)]),a("p",_e," 經驗年數："+l(o.yearOfExperience)+" 年 ",1),a("p",xe," 時薪："+l(o.hourlyRate?`${o.hourlyRate} 元/小時`:"未提供"),1),a("p",Ie," 半日薪水："+l(o.halfDayRate?`${o.halfDayRate} 元/半日`:"未提供"),1),a("p",Te," 全日薪水："+l(o.fullDayRate?`${o.fullDayRate} 元/全日`:"未提供"),1),a("p",De,l(o.description||"尚無詳細介紹"),1),a("p",Ce," 預估總價："+l(i.value[o.caregiverId]!==void 0?`${i.value[o.caregiverId]} 元`:"計算中..."),1)])],8,me))),128))])])}}},we=w($e,[["__scopeId","data-v-707ce4e3"]]);export{we as default};
